<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="../oc-core-utils/oc-core.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../oc-core-utils/oc-api-consumer-behaviour.html">
<link rel="import" href="../oc-organisation-api/oc-organisation-api.html">

<!--
`oc-list-organisations`
An element displaying an organisation mobile list friendly

@demo demo/index.html
-->

<dom-module id="oc-list-organisations">

  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
      :host {
        display: block;
        color: :000;
        background: #fff;
      }
      .organistaion-icon {
        padding: 5px;
        height: 36px;
      }

      .organistaion-logo {
        width: 100px;
        background: #BFD730;
        border-radius: 5px;
        padding: 5px;
      }
      .paper-material-container {
        padding: 5px;
      }
      .controls-row {
        border-top: 1px solid #D7D7D7;
      }
      .favourite-icon {
        height: 24px;
      }
      .margin-0 {
        margin: 0;
      }
      .spacing {
        padding: 20px 0;
        background: #bfd730;
      }
      .white-bg {
        background: #fff;
      }


    </style>
    <oc-organisation-api id="organisationApi"></oc-organisation-api>
    <template class="container-fluid margin-10" is="dom-repeat" items="[[organisations]]" style="margin:20px;">
      <div class="spacing">
      <paper-material elevation="1" class="white-bg">
      <div class="row paper-material-container margin-10">
        <div class="col-xs-4">
          <img src="../../images/elmi-distributors.png" alt="Elmi Distributors" class="organistaion-logo">
        </div>
        <div class="col-xs-8">
          <div class="row">
            <div class="col-xs-12">
              <div class="pull-right"><img src="../../images/Favourite-Icon.png" alt="" class="favourite-icon"></div>
              <p>[[item.toOrganisation.name]]</p>
              <p>[[item.toOrganisation.status.description]]</p>
              <p>[[item.toOrganisation.profile.address.city]]</p>
            </div>
          </div>
          <div class="row margin-0">
            <div class="col-xs-6 controls-row">
              <img src="../../images/Pay-Icon.png" alt="Pay Icon" class="organistaion-icon">
              Pay
            </div>
            <div class="col-xs-6 controls-row">
              <img src="../../images/Map-Pin-Icon.png" alt="Map Pin Icon" class="organistaion-icon">
              11.2km
            </div>
          </div>
        </div>
      </div>
    </paper-material>
    </div>
  </template>
</template>

  <script>
    Polymer({

      is: 'oc-list-organisations',
      behaviors: [OC.Behaviours.ApiConsumer],

      properties: {
        organisationId: {
        type: Number
      },
        organisations: {
          type: Array,
          notify: true
        },
      },
      observers: [
      '_init(organisationId)'
    ],

      ready: function() {
        this._init()
      },

      _init: function() {
        this._getOrganisationConnections(OC.organisationId, "M", 200000, -33.924246, 18.413985, 1, -1);
      },

      _getOrganisationConnections: function(organisationId, type, radius, lat ,long , page, pagesize) {
        this.$.organisationApi.getOrganisationConnections(organisationId, type, radius, lat ,long , page, pagesize)
        .then(function(request){
                     var data = request.response.results;
                     this.organisations = data;
                   }.bind(this));
      }
    });
  </script>
</dom-module>
